# site.yml


## 2de zit docker
- hosts: pr010
  become: true
  roles:
    - geerlingguy.docker
  pre_tasks:
    - name: install development packages
      package: name=libselinux-python
               state=present
    - name: Copy new ansible.cfg
      copy:
        src: actua/ansible.cfg
        dest: /home/vagrant/ansible.cfg
  post_tasks:
      - name: Command docker-compose up
        command: /usr/local/bin/docker-compose up -d
        chdir: /vagrant/ansible


  ##lamp
- hosts: pu004
  become: true
  roles:
    - bertvv.rh-base
    - bertvv.mariadb
    - bertvv.httpd
    - bertvv.wordpress
  pre_tasks:
    - name: Copy new key
      copy:
        src: keycert/newkey.key
        dest: /etc/pki/tls/private/newkey.key
    - name: Copy new cert
      copy:
        src: keycert/newcert.crt
        dest: /etc/pki/tls/certs/newcert.crt
    - name: Copy new ansible.cfg
      copy:
        src: actua/ansible.cfg
        dest: /home/vagrant/ansible.cfg

#dns
- hosts: pu001,pu002
  become: true
  roles:
    - bertvv.rh-base
    - bertvv.bind
  pre_tasks:
      - name: Copy new ansible.cfg
        copy:
          src: actua/ansible.cfg
          dest: /home/vagrant/ansible.cfg

#fileshare
- hosts: pr011
  become: true
  roles:
    - bertvv.rh-base
    - bertvv.samba
    - bertvv.vsftpd
  pre_tasks:
      - name: Copy new ansible.cfg
        copy:
          src: actua/ansible.cfg
          dest: /home/vagrant/ansible.cfg
  post_tasks:
    - name: ACL sales
      acl:
        path: /srv/shares/sales
        entity: management
        etype: group
        permissions: rx
        state: present
    - name: ACL it
      acl:
        path: /srv/shares/it
        entity: management
        etype: group
        permissions: rx
        state: present
    - name: ACL technical
      acl:
        path: /srv/shares/technical
        entity: public
        etype: group
        permissions: rx
        state: present
#DHCP
- hosts: pr001
  become: true
  roles:
    - bertvv.rh-base
    - bertvv.dhcp
  pre_tasks:
      - name: Copy new ansible.cfg
        copy:
          src: actua/ansible.cfg
          dest: /home/vagrant/ansible.cfg
